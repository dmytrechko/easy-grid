!function(){function t(n,r){return t.prototype.instances.indexOf(n)!==-1?(console.warn("Selector "+n+" already used for Grid!"),!1):(t.prototype.instances.push(n),e(this).options=r||{},e(this).plugins={},e(this).container=document.querySelector(n),e(this).url=this.config("url"),e(this).target=document.querySelector(this.config("target")),e(this).template=document.querySelector(this.config("template")).innerHTML,e(this).fetchParams={method:this.config("fetchMethod"),headers:this.config("fetchHeaders"),body:this.config("fetchBody"),mode:this.config("fetchMode"),credentials:this.config("fetchCredentials")},e(this).query={},e(this).fetched=[],e(this).rendered="",e(this).meta={},e(this).extra={},this.initPlugins(),void this.run())}var e=PrivateParts.createKey();t.prototype.instances=[],t.prototype.defaults={fetchMethod:"get",fetchHeaders:{},fetchBody:null,fetchMode:"same-origin",fetchCredentials:"same-origin"},t.prototype.plugins={},t.prototype.registerPlugin=function(e,n){return Object.keys(t.prototype.plugins).indexOf(e)!==-1?(console.warn("Plugin with name "+e+" already exists!"),!1):(t.prototype.plugins[e]=n,!0)},t.prototype.initPlugins=function(){for(name in t.prototype.plugins)e(this).plugins[name]=new t.prototype.plugins[name],e(this).plugins[name].init?e(this).plugins[name].init(this):console.warn("There is no init method in "+name+" plugin")},t.prototype.passThroughPlugins=function(){for(name in t.prototype.plugins)e(this).plugins[name].modify?e(this).plugins[name].modify():console.warn("There is no modify method in "+name+" plugin")},t.prototype.config=function(n,r){return r=r||null,e(this).container.dataset[n]||e(this).options[n]||t.prototype.defaults[n]||r},t.prototype.fire=function(t,n){var r=new Event(t,n||{});e(this).container.dispatchEvent(r)},t.prototype.run=function(){var t=this;this.fetch().then(function(){return t.passThroughPlugins()}).then(function(){return t.render()}).then(function(){return t.insert()})},t.prototype.refresh=function(){this.passThroughPlugins(),this.render(),this.insert()},t.prototype.fetch=function(){var t=this;return t.fire("grid:fetch:before"),fetch(this.getUrl(!0),this.getFetchParams()).then(function(t){return t.json()},function(){t.fire("grid:fetch:fail")}).then(function(e){t.setFetched(e.results),t.setMeta(e.meta||{}),t.fire("grid:fetch:after")})},t.prototype.render=function(){this.fire("grid:render:before");var t,n=_.template(e(this).template);t=n({results:this.getFetched(),meta:this.getMeta(),extra:this.getExtra()}),this.setRendered(t),this.fire("grid:render:after")},t.prototype.insert=function(){this.fire("grid:insert:before"),e(this).target.innerHTML=this.getRendered(),this.fire("grid:insert:after")},t.prototype.getContainer=function(){return e(this).container},t.prototype.getUrl=function(t){var n=this,r=e(this).url;return t&&(r+="?"+Object.keys(n.getQuery()).map(function(t){return new String(t+"="+n.getQuery()[t])}).join("&")),encodeURI(r)},t.prototype.setUrl=function(t){return e(this).url=t,this},t.prototype.getQuery=function(){return e(this).query},t.prototype.setQuery=function(t,n){return e(this).query[t]=n,this},t.prototype.getFetchParams=function(){return e(this).fetchParams},t.prototype.setFetchParams=function(t){return e(this).FetchParams=t,this},t.prototype.getTemplate=function(){return e(this).template},t.prototype.setTemplate=function(t){return e(this).template=t,this},t.prototype.getFetched=function(){return e(this).fetched},t.prototype.setFetched=function(t){return e(this).fetched=t,this},t.prototype.getMeta=function(){return e(this).meta},t.prototype.setMeta=function(t){return e(this).meta=t,this},t.prototype.getExtra=function(){return e(this).extra},t.prototype.setExtra=function(t,n){return e(this).extra[t]=n,this},t.prototype.getRendered=function(){return e(this).rendered},t.prototype.setRendered=function(t){return e(this).rendered=t,this},window.Grid=t}();