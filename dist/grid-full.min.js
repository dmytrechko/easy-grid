!function(){function t(n,i){return t.prototype.instances.indexOf(n)!==-1?(console.warn("Selector "+n+" already used for EasyGrid!"),!1):(t.prototype.instances.push(n),e(this).options=i||{},e(this).plugins={},e(this).container=document.querySelector(n),e(this).url=this.config("url"),e(this).target=document.querySelector(this.config("target")),e(this).template=document.querySelector(this.config("template")).innerHTML,e(this).fetchParams={method:this.config("fetchMethod"),headers:this.config("fetchHeaders"),body:this.config("fetchBody"),mode:this.config("fetchMode"),credentials:this.config("fetchCredentials")},e(this).query={},e(this).fetched=[],e(this).rendered="",e(this).meta={},e(this).extra={},this.initPlugins(),void this.run())}var e=PrivateParts.createKey();t.prototype.instances=[],t.prototype.defaults={fetchMethod:"get",fetchHeaders:{},fetchBody:null,fetchMode:"same-origin",fetchCredentials:"same-origin"},t.prototype.plugins={},t.prototype.registerPlugin=function(e,n){return Object.keys(t.prototype.plugins).indexOf(e)!==-1?(console.warn("Plugin with name "+e+" already exists!"),!1):(t.prototype.plugins[e]=n,!0)},t.prototype.initPlugins=function(){for(name in t.prototype.plugins)e(this).plugins[name]=new t.prototype.plugins[name],e(this).plugins[name].init?e(this).plugins[name].init(this):console.warn("There is no init method in "+name+" plugin")},t.prototype.passThroughPlugins=function(){for(name in t.prototype.plugins)e(this).plugins[name].modify?e(this).plugins[name].modify():console.warn("There is no modify method in "+name+" plugin")},t.prototype.config=function(n,i){return i=i||null,e(this).container.dataset[n]||e(this).options[n]||t.prototype.defaults[n]||i},t.prototype.fire=function(t,n){var i=new Event(t,n||{});e(this).container.dispatchEvent(i)},t.prototype.run=function(){var t=this;this.fetch().then(function(){return t.passThroughPlugins()}).then(function(){return t.render()}).then(function(){return t.insert()})},t.prototype.refresh=function(){this.passThroughPlugins(),this.render(),this.insert()},t.prototype.fetch=function(){var t=this;return t.fire("grid:fetch:before"),fetch(this.getUrl(!0),this.getFetchParams()).then(function(t){return t.json()},function(){t.fire("grid:fetch:fail")}).then(function(e){t.setFetched(e.results),t.setMeta(e.meta||{}),t.fire("grid:fetch:after")})},t.prototype.render=function(){this.fire("grid:render:before");var t,n=_.template(e(this).template);t=n({results:this.getFetched(),meta:this.getMeta(),extra:this.getExtra()}),this.setRendered(t),this.fire("grid:render:after")},t.prototype.insert=function(){this.fire("grid:insert:before"),e(this).target.innerHTML=this.getRendered(),this.fire("grid:insert:after")},t.prototype.getContainer=function(){return e(this).container},t.prototype.getUrl=function(t){var n=this,i=e(this).url;return t&&(i+="?"+Object.keys(n.getQuery()).map(function(t){return new String(t+"="+n.getQuery()[t])}).join("&")),encodeURI(i)},t.prototype.setUrl=function(t){return e(this).url=t,this},t.prototype.getQuery=function(){return e(this).query},t.prototype.setQuery=function(t,n){return e(this).query[t]=n,this},t.prototype.getFetchParams=function(){return e(this).fetchParams},t.prototype.setFetchParams=function(t){return e(this).FetchParams=t,this},t.prototype.getTemplate=function(){return e(this).template},t.prototype.setTemplate=function(t){return e(this).template=document.querySelector(t).innerHTML,this},t.prototype.getFetched=function(){return e(this).fetched},t.prototype.setFetched=function(t){return e(this).fetched=t,this},t.prototype.getMeta=function(){return e(this).meta},t.prototype.setMeta=function(t){return e(this).meta=t,this},t.prototype.getExtra=function(){return e(this).extra},t.prototype.setExtra=function(t,n){return e(this).extra[t]=n,this},t.prototype.getRendered=function(){return e(this).rendered},t.prototype.setRendered=function(t){return e(this).rendered=t,this},window.EasyGrid=t}(),function(){function t(){}t.prototype.init=function(t){this.gridInstance=t;var e=this,n=this.gridInstance.config("pluginLimitTrigger","change");this.gridInstance.getContainer().addEventListener(n,function(t){"undefined"!=typeof t.target.dataset.actionLimit&&e.changeLimit.call(e,t)})},t.prototype.modify=function(){return!0},t.prototype.changeLimit=function(t){var e=t.target.value;return this.gridInstance.setQuery("limit",e),this.gridInstance.setExtra("limit",e),this.gridInstance.run()},EasyGrid.prototype.registerPlugin("limit",t)}(),function(){function t(){}t.prototype.init=function(t){this.gridInstance=t;var e=this,n=this.gridInstance.config("pluginPaginationTrigger","click");this.gridInstance.getContainer().addEventListener(n,function(t){return t.preventDefault(),"undefined"!=typeof t.target.dataset.actionGoFirst?(e.goFirst.call(e,t),!0):"undefined"!=typeof t.target.dataset.actionGoLast?(e.goLast.call(e,t),!0):"undefined"!=typeof t.target.dataset.actionGoNext?(e.goNext.call(e,t),!0):"undefined"!=typeof t.target.dataset.actionGoPrevious?(e.goPrevious.call(e,t),!0):"undefined"!=typeof t.target.dataset.actionGoTo?(e.goTo.call(e,t),!0):void 0})},t.prototype.modify=function(){var t=Math.ceil(this.gridInstance.getMeta().count/this.gridInstance.getMeta().limit);return this.gridInstance.setExtra("currentPage",this.gridInstance.getExtra().currentPage||1),this.gridInstance.getExtra().currentPage>t&&this.goToPage(t),this.gridInstance.setExtra("pages",t),!0},t.prototype.goFirst=function(t){this.goToPage(1)},t.prototype.goLast=function(t){this.goToPage(this.gridInstance.getExtra().pages)},t.prototype.goPrevious=function(t){this.goToPage(this.gridInstance.getExtra().currentPage-1)},t.prototype.goNext=function(t){this.goToPage(this.gridInstance.getExtra().currentPage+1)},t.prototype.goTo=function(t){var e=t.target.dataset.page||this.gridInstance.getExtra().currentPage;this.goToPage(e)},t.prototype.goToPage=function(t){var e,n=+this.gridInstance.getMeta().limit;return e=t?(t-1)*n:0,this.gridInstance.setQuery("offset",e),this.gridInstance.setExtra("currentPage",+t),this.gridInstance.run()},EasyGrid.prototype.registerPlugin("pagination",t)}(),function(){function t(){}t.prototype.init=function(t){this.gridInstance=t;var e=this,n=this.gridInstance.config("pluginSearchTrigger","click");this.gridInstance.getContainer().addEventListener(n,function(t){if(t.preventDefault(),"undefined"!=typeof t.target.dataset.actionSearch)return e.search.call(e,t),!0})},t.prototype.modify=function(){return!0},t.prototype.search=function(t){var e=this.gridInstance.getContainer().querySelector('[data-container="search"]'),n=e.value||"";this.gridInstance.setQuery("search",encodeURIComponent(n)),this.gridInstance.run()},EasyGrid.prototype.registerPlugin("search",t)}(),function(){function t(){}t.prototype.init=function(t){this.gridInstance=t;var e=this,n=this.gridInstance.config("pluginFiltersTrigger","click");this.gridInstance.getContainer().addEventListener(n,function(t){if(t.preventDefault(),"undefined"!=typeof t.target.dataset.actionFilter)return e.setFilter.call(e,t),!0})},t.prototype.modify=function(){return!0},t.prototype.setFilter=function(t){var e=t.target.dataset.actionFilter,n=this.gridInstance.getMeta()||{},i=n.filters||[];i.indexOf(e)==-1?Array.prototype.push.call(i,e):Array.prototype.splice.call(i,i.indexOf(e),1),n.filters=i,this.gridInstance.setMeta(n),this.gridInstance.setQuery("filters",i),this.gridInstance.run()},EasyGrid.prototype.registerPlugin("filters",t)}();